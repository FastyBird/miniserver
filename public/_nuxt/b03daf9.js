(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{681:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n,o,c,d=r(3),l=(r(40),r(32),r(64),r(48),r(59),r(84),r(20)),f=r(2),m=r(98),v=r.n(m),_=r(18),h=(r(24),r(38)),E=r(25),w=r(43),y=r(36),T=r(45),k=(r(21),r(76)),C=r(75);!function(e){e.TIME_SCHEDULED="timeScheduled",e.DATE_SCHEDULED="dateScheduled",e.DEVICE="device",e.SENSOR="sensor",e.MANUAL="manual"}(n||(n={})),function(e){e.DEVICE_CONDITION="deviceCondition",e.CHANNEL_CONDITION="channelCondition"}(o||(o={})),function(e){e.DEVICE_ACTION="deviceAction",e.CHANNEL_ACTION="channelAction"}(c||(c={})),t.b=function(e,form){var t=v.a.v4().toString(),r=Object(l.a)((function(){return h.a.query().where("triggerId",t).all()})),n=Object(l.a)((function(){return w.a.query().where("triggerId",t).all()})),m=Object(l.a)((function(){return _.a.query().with("conditions").with("actions").with("notifications").where("id",t).first()}));function I(){return(I=Object(d.a)(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===form.model.date){e.next=13;break}if(null===form.model.date.condition){e.next=11;break}if(null===(r=h.a.find(form.model.date.condition))){e.next=8;break}return e.next=6,h.a.update({where:r.id,data:{date:form.model.date.date}});case 6:e.next=9;break;case 8:throw new Error("Unknown condition");case 9:e.next=13;break;case 11:return e.next=13,h.a.insert({data:{id:v.a.v4().toString(),trigger:m.value,triggerId:t,draft:!0,type:E.a.DATE,enabled:!0,date:form.model.date.date}});case 13:return e.abrupt("return",!0);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(){return(O=Object(d.a)(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===form.model.time){e.next=13;break}if(null===form.model.time.condition){e.next=11;break}if(null===(r=h.a.find(form.model.time.condition))){e.next=8;break}return e.next=6,h.a.update({where:r.id,data:{time:form.model.time.time,days:form.model.time.days}});case 6:e.next=9;break;case 8:throw new Error("Unknown condition");case 9:e.next=13;break;case 11:return e.next=13,h.a.insert({data:{id:v.a.v4().toString(),trigger:m.value,triggerId:t,draft:!0,type:E.a.TIME,enabled:!0,time:form.model.time.time,days:form.model.time.days}});case 13:return e.abrupt("return",!0);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return{triggerId:t,conditions:r,actions:n,trigger:m,configureDate:function(){var e=h.a.query().where("triggerId",t).where("type",E.a.DATE).first();return null!==e?{selected:!0,date:new Date(e.date).toISOString(),condition:e.id}:{selected:!1,date:(new Date).toISOString(),condition:null}},configureTime:function(){var e=h.a.query().where("triggerId",t).where("type",E.a.TIME).first();return null!==e?{selected:!0,time:new Date(e.time).toISOString(),days:e.days,condition:e.id}:{selected:!1,time:(new Date).toISOString(),days:[1,2,3,4,5,6,7],condition:null}},configureDeviceCondition:function(e){var data={};return e.channels.forEach((function(e){e.properties.forEach((function(e){void 0!==data&&(data[e.id]={selected:!1,type:o.CHANNEL_CONDITION,operator:f.l.EQUAL,operand:null,condition:null})}))})),e.properties.forEach((function(e){void 0!==data&&(data[e.id]={selected:!1,type:o.DEVICE_CONDITION,operator:f.l.EQUAL,operand:null,condition:null})})),h.a.query().where("triggerId",t).all().forEach((function(t){var r=null;t.isDeviceProperty&&t.device===e.key?r=k.a.query().where("key",t.property).whereHas("deviceBackward",(function(e){e.where("key",t.device)})).first():t.isChannelProperty&&t.device===e.key&&(r=C.a.query().where("key",t.property).whereHas("channelBackward",(function(e){e.where("key",t.channel).with("deviceBackward",(function(e){e.where("key",t.device)}))})).first()),null!==r&&Object.prototype.hasOwnProperty.call(data,r.id)&&void 0!==data&&Object.assign(data[r.id],{selected:!0,operator:t.operator,operand:t.operand,condition:t.id})})),data},configureDeviceAction:function(e){var data={};return e.channels.forEach((function(e){e.properties.forEach((function(e){void 0!==data&&(data[e.id]={selected:!1,operation:null,type:c.CHANNEL_ACTION,action:null})}))})),e.properties.forEach((function(e){void 0!==data&&(data[e.id]={selected:!1,operation:null,type:c.DEVICE_ACTION,action:null})})),w.a.query().where("triggerId",t).all().forEach((function(t){var r=null;t.isDeviceProperty&&t.device===e.key?r=k.a.query().where("key",t.property).whereHas("deviceBackward",(function(e){e.where("key",t.device)})).first():t.isChannelProperty&&t.device===e.key&&(r=C.a.query().where("key",t.property).whereHas("channelBackward",(function(e){e.where("key",t.channel).with("deviceBackward",(function(e){e.where("key",t.device)}))})).first()),null!==r&&Object.prototype.hasOwnProperty.call(data,r.id)&&void 0!==data&&Object.assign(data[r.id],{selected:!0,operation:t.value,action:t.id})})),data},submitConditionDevice:function(){if(void 0===form.model.conditions)throw new TypeError("Unknown condition");var e=!1;return Object.keys(form.model.conditions).forEach((function(t){void 0!==form.model.conditions&&form.model.conditions[t].selected&&null!==form.model.conditions[t].operand&&(e=!0)})),!!e&&(Object.keys(form.model.conditions).forEach(function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(r){var n,c,d,l,f,_,w,y;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===form.model.conditions){e.next=47;break}if(n=form.model.conditions[r].condition,c=null,null===n){e.next=7;break}if(null!==(c=h.a.find(n))){e.next=7;break}throw new Error("Unknown condition");case 7:if(form.model.conditions[r].type!==o.DEVICE_CONDITION){e.next=28;break}if(!form.model.conditions[r].selected){e.next=23;break}if(null===c){e.next=14;break}return e.next=12,h.a.update({where:c.id,data:{operator:form.model.conditions[r].operator,operand:form.model.conditions[r].operand}});case 12:e.next=21;break;case 14:if(null===(d=k.a.query().with("deviceBackward").where("id",r).has("deviceBackward").first())){e.next=20;break}return e.next=18,h.a.insert({data:{id:v.a.v4().toString(),trigger:m.value,triggerId:t,draft:!0,type:E.a.DEVICE_PROPERTY,enabled:!0,operator:form.model.conditions[r].operator,operand:form.model.conditions[r].operand,device:null===(l=d.deviceBackward)||void 0===l?void 0:l.key,property:d.key}});case 18:e.next=21;break;case 20:throw new Error("Unknown device property");case 21:e.next=26;break;case 23:if(null===c){e.next=26;break}return e.next=26,h.a.delete(c.id);case 26:e.next=47;break;case 28:if(form.model.conditions[r].type!==o.CHANNEL_CONDITION){e.next=47;break}if(!form.model.conditions[r].selected){e.next=44;break}if(null===c){e.next=35;break}return e.next=33,h.a.update({where:c.id,data:{operator:form.model.conditions[r].operator,operand:form.model.conditions[r].operand}});case 33:e.next=42;break;case 35:if(null===(f=C.a.query().with("channelBackward").with("channelBackward.deviceBackward").has("channelBackward").where("id",r).first())){e.next=41;break}return e.next=39,h.a.insert({data:{id:v.a.v4().toString(),trigger:m.value,triggerId:t,draft:!0,type:E.a.CHANNEL_PROPERTY,enabled:!0,operator:form.model.conditions[r].operator,operand:form.model.conditions[r].operand,device:null===(_=f.channelBackward)||void 0===_||null===(w=_.deviceBackward)||void 0===w?void 0:w.key,channel:null===(y=f.channelBackward)||void 0===y?void 0:y.key,property:f.key}});case 39:e.next=42;break;case 41:throw new Error("Unknown device property");case 42:e.next=47;break;case 44:if(null===c){e.next=47;break}return e.next=47,h.a.delete(c.id);case 47:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),!0)},submitActionDevice:function(){if(void 0===form.model.actions)throw new TypeError("Unknown action");var e=!1;return Object.keys(form.model.actions).forEach((function(t){void 0!==form.model.actions&&form.model.actions[t].selected&&null!==form.model.actions[t].operation&&(e=!0)})),!!e&&(Object.keys(form.model.actions).forEach(function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(r){var n,o,d,l,f,_,h,E;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===form.model.actions){e.next=47;break}if(n=form.model.actions[r].action,o=null,null===n){e.next=7;break}if(null!==(o=w.a.find(n))){e.next=7;break}throw new Error("Unknown action");case 7:if(form.model.actions[r].type!==c.DEVICE_ACTION){e.next=28;break}if(!form.model.actions[r].selected){e.next=23;break}if(null===o){e.next=14;break}return e.next=12,w.a.update({where:o.id,data:{value:form.model.actions[r].operation}});case 12:e.next=21;break;case 14:if(null===(d=k.a.query().with("deviceBackward").where("id",r).has("deviceBackward").first())){e.next=20;break}return e.next=18,w.a.insert({data:{id:v.a.v4().toString(),trigger:m.value,triggerId:t,draft:!0,type:y.a.DEVICE_PROPERTY,enabled:!0,value:form.model.actions[r].operation,device:null===(l=d.deviceBackward)||void 0===l?void 0:l.key,property:d.key}});case 18:e.next=21;break;case 20:throw new Error("Unknown device property");case 21:e.next=26;break;case 23:if(null===o){e.next=26;break}return e.next=26,w.a.remove(o);case 26:e.next=47;break;case 28:if(form.model.actions[r].type!==c.CHANNEL_ACTION){e.next=47;break}if(!form.model.actions[r].selected){e.next=44;break}if(null===o){e.next=35;break}return e.next=33,w.a.update({where:o.id,data:{value:form.model.actions[r].operation}});case 33:e.next=42;break;case 35:if(null===(f=C.a.query().with("channelBackward").with("channelBackward.deviceBackward").has("channelBackward").where("id",r).first())){e.next=41;break}return e.next=39,w.a.insert({data:{id:v.a.v4().toString(),trigger:m.value,triggerId:t,draft:!0,type:y.a.CHANNEL_PROPERTY,enabled:!0,value:form.model.actions[r].operation,device:null===(_=f.channelBackward)||void 0===_||null===(h=_.deviceBackward)||void 0===h?void 0:h.key,channel:null===(E=f.channelBackward)||void 0===E?void 0:E.key,property:f.key}});case 39:e.next=42;break;case 41:throw new Error("Unknown device property");case 42:e.next=47;break;case 44:if(null===o){e.next=47;break}return e.next=47,w.a.remove(o);case 47:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),!0)},submitDate:function(){return I.apply(this,arguments)},submitTime:function(){return O.apply(this,arguments)},destroy:function(){null!==m.value&&(m.value.conditions.forEach((function(e){e.draft&&h.a.delete(e.id)})),m.value.actions.forEach((function(e){e.draft&&w.a.delete(e.id)})),m.value.notifications.forEach((function(e){e.draft&&T.a.delete(e.id)}))),null!==m.value&&m.value.draft&&_.a.remove(m.value)}}}},687:function(e,t,r){var content=r(702);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(94).default)("2f523fe5",content,!0,{sourceMap:!1})},701:function(e,t,r){"use strict";r(687)},702:function(e,t,r){var n=r(93)(!1);n.push([e.i,".fb-triggers-create-general__general,.fb-triggers-create-general__general>span{display:block}.fb-triggers-create-general__items{margin-bottom:0}.fb-triggers-create-general__items-container{overflow:auto}.fb-triggers-create-general__add-item-row.fb-ui-button[data-size=lg]{padding:0;font-size:1.8rem;line-height:5.3rem}",""]),e.exports=n},711:function(e,t,r){"use strict";var n=r(3),o=(r(40),r(68),r(32),r(64),r(49),r(139),r(20)),c=r(16),d=r(677),l=r(18),f=(r(24),r(43)),m=(r(36),r(38)),v=r(25),_=r(715),h=r(714),E=r(681),w=Object(o.b)({name:"TriggersCreateGeneral",components:{TriggersListCondition:_.a,TriggersListAction:h.a,ValidationProvider:d.b,ValidationObserver:d.a},props:{trigger:{type:Object,required:!0},type:{type:String,required:!0},remoteFormSubmit:{type:Boolean,default:!1},remoteFormResult:{type:String,default:c.g.NONE}},setup:function(e,t){var r,_=Object(o.l)(),h=_.app.i18n,w=_.error,y=Object(o.j)(),T=Object(o.j)(e.type===E.a.TIME_SCHEDULED),k=Object(o.j)(e.type===E.a.DATE_SCHEDULED),C=Object(o.j)(e.type===E.a.DEVICE),I=Object(o.j)(e.type===E.a.SENSOR),O=Object(o.j)(e.type===E.a.MANUAL),D=Object(o.a)((function(){return m.a.query().where("triggerId",e.trigger.id).where("type",(function(e){return e===v.a.TIME||e===v.a.DATE})).first()})),N=Object(o.a)((function(){return m.a.query().where("triggerId",e.trigger.id).where("type",(function(e){return e!==v.a.TIME&&e!==v.a.DATE})).all()})),S=Object(o.a)((function(){return f.a.query().where("triggerId",e.trigger.id).all()})),form=Object(o.i)({model:{name:e.trigger.name,comment:e.trigger.comment}});function A(){window.clearInterval(r),t.emit("created")}return Object(d.d)({en:{fields:{triggerName:{required:h.t("triggers.fields.triggerName.validation.required").toString()}}}}),Object(d.c)("required",{validate:function(e){return{required:!0,valid:!["",null,void 0].includes(e)}},computesRequired:!0}),Object(o.p)((function(){return e.remoteFormSubmit}),(function(o){o&&(t.emit("update:remoteFormSubmit",!1),t.emit("update:remoteFormResult",c.g.WORKING),null!==y.value&&void 0!==y.value&&y.value.validate().then(function(){var o=Object(n.a)(regeneratorRuntime.mark((function n(o){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!o){n.next=14;break}return n.prev=1,n.next=4,l.a.save(e.trigger);case 4:t.emit("update:remoteFormResult",c.g.OK),r=window.setInterval(A,2e3),n.next=12;break;case 8:n.prev=8,n.t0=n.catch(1),t.emit("update:remoteFormResult",c.g.ERROR),r=window.setInterval((function(){t.emit("update:remoteFormResult",c.g.NONE),window.clearInterval(r)}),2e3);case 12:n.next=15;break;case 14:t.emit("update:remoteFormResult",c.g.NONE);case 15:case"end":return n.stop()}}),n,null,[[1,8]])})));return function(e){return o.apply(this,arguments)}}()))})),Object(o.p)((function(){return e.type}),(function(e){T.value=e===E.a.TIME_SCHEDULED,k.value=e===E.a.DATE_SCHEDULED,C.value=e===E.a.DEVICE,I.value=e===E.a.SENSOR,O.value=e===E.a.MANUAL})),{validator:y,isTimeScheduled:T,isDateScheduled:k,isDeviceCondition:C,isSensorCondition:I,isManual:O,schedule:D,conditions:N,actions:S,form:form,handleUpdate:function(){l.a.edit(e.trigger,{name:form.model.name,comment:form.model.comment}).catch((function(){w({statusCode:503,message:"Something went wrong"})}))},sizeTypes:c.J,buttonVariantTypes:c.N}}}),y=(r(701),r(58)),component=Object(y.a)(w,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"fb-triggers-create-general__container"},[r("validation-observer",{ref:"validator",staticClass:"fb-triggers-create-general__general"},[r("validation-provider",{attrs:{name:"triggerName",rules:"required"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.errors;return[r("fb-ui-content",{attrs:{mb:e.sizeTypes.MEDIUM}},[r("fb-form-input",{attrs:{error:n[0],"has-error":n.length>0,label:e.$t("triggers.fields.triggerName.title"),placeholder:e.$t("triggers.fields.triggerName.placeholder"),required:!0,"tab-index":2,name:"triggerName"},on:{blur:e.handleUpdate},model:{value:e.form.model.name,callback:function(t){e.$set(e.form.model,"name",t)},expression:"form.model.name"}})],1)]}}])}),e._v(" "),r("fb-form-text-area",{attrs:{label:e.$t("triggers.fields.triggerComment.title"),placeholder:e.$t("triggers.fields.triggerComment.placeholder"),"tab-index":3,name:"triggerComment"},on:{blur:e.handleUpdate},model:{value:e.form.model.comment,callback:function(t){e.$set(e.form.model,"comment",t)},expression:"form.model.comment"}})],1),e._v(" "),r("div",{staticClass:"fb-triggers-create-general__items-container"},[e.isDeviceCondition||e.isSensorCondition?[r("fb-ui-items-container",{staticClass:"fb-triggers-create-general__items"},[r("template",{slot:"heading"},[e._v("\n          "+e._s(e.$tc("triggers.headings.conditions",e.conditions.length,{count:e.conditions.length}))+"\n        ")]),e._v(" "),0===e.conditions.length?r("fb-ui-button",{staticClass:"fb-triggers-create-general__add-item-row",attrs:{variant:e.buttonVariantTypes.OUTLINE_DEFAULT,size:e.sizeTypes.LARGE,block:""},on:{click:function(t){return e.$emit("addCondition")}}},[r("font-awesome-icon",{attrs:{icon:"plus-circle"}}),e._v(" "),r("span",[e._v(e._s(e.$t("triggers.buttons.addDevice.title")))])],1):e._e(),e._v(" "),e._l(e.conditions,(function(t){return r("triggers-list-condition",{key:t.id,attrs:{trigger:e.trigger,condition:t}})})),e._v(" "),e.conditions.length>0?r("template",{slot:"buttons"},[r("fb-ui-button",{attrs:{variant:e.buttonVariantTypes.LINK,size:e.sizeTypes.EXTRA_SMALL},on:{click:function(t){return e.$emit("addCondition")}}},[r("font-awesome-icon",{attrs:{icon:"plus"}}),e._v("\n            "+e._s(e.$t("application.buttons.add.title"))+"\n          ")],1)],1):e._e()],2),e._v(" "),r("hr")]:e._e(),e._v(" "),e.isTimeScheduled?[r("fb-ui-items-container",{staticClass:"fb-triggers-create-general__items"},[r("template",{slot:"heading"},[e._v("\n          "+e._s(e.$t("triggers.headings.scheduledTime"))+"\n        ")]),e._v(" "),null===e.schedule?r("fb-ui-button",{staticClass:"fb-triggers-create-general__add-item-row",attrs:{variant:e.buttonVariantTypes.OUTLINE_DEFAULT,size:e.sizeTypes.LARGE,block:""},on:{click:function(t){return e.$emit("addTimeSchedule")}}},[r("font-awesome-icon",{attrs:{icon:"plus-circle"}}),e._v(" "),r("span",[e._v(e._s(e.$t("triggers.buttons.addTime.title")))])],1):e._e(),e._v(" "),null!==e.schedule?r("triggers-list-condition",{attrs:{trigger:e.trigger,condition:e.schedule}}):e._e()],2),e._v(" "),r("hr")]:e._e(),e._v(" "),e.isDateScheduled?[r("fb-ui-items-container",{staticClass:"fb-triggers-create-general__items"},[r("template",{slot:"heading"},[e._v("\n          "+e._s(e.$t("triggers.headings.scheduledDate"))+"\n        ")]),e._v(" "),null===e.schedule?r("fb-ui-button",{staticClass:"fb-triggers-create-general__add-item-row",attrs:{variant:e.buttonVariantTypes.OUTLINE_DEFAULT,size:e.sizeTypes.LARGE,block:""},on:{click:function(t){return e.$emit("addDateSchedule")}}},[r("font-awesome-icon",{attrs:{icon:"plus-circle"}}),e._v(" "),r("span",[e._v(e._s(e.$t("triggers.buttons.addDate.title")))])],1):e._e(),e._v(" "),null!==e.schedule?r("triggers-list-condition",{attrs:{trigger:e.trigger,condition:e.schedule}}):e._e()],2),e._v(" "),r("hr")]:e._e(),e._v(" "),r("fb-ui-items-container",{staticClass:"fb-triggers-create-general__items"},[r("template",{slot:"heading"},[e._v("\n        "+e._s(e.$tc("triggers.headings.actions",e.actions.length,{count:e.actions.length}))+"\n      ")]),e._v(" "),0===e.actions.length?r("fb-ui-button",{staticClass:"fb-triggers-create-general__add-item-row",attrs:{variant:e.buttonVariantTypes.OUTLINE_DEFAULT,size:e.sizeTypes.LARGE,block:""},on:{click:function(t){return e.$emit("addAction")}}},[r("font-awesome-icon",{attrs:{icon:"plus-circle"}}),e._v(" "),r("span",[e._v(e._s(e.$t("triggers.buttons.addAccessory.title")))])],1):e._e(),e._v(" "),e._l(e.actions,(function(t){return r("triggers-list-action",{key:t.id,attrs:{trigger:e.trigger,action:t}})})),e._v(" "),e.actions.length>0?r("template",{slot:"buttons"},[r("fb-ui-button",{attrs:{variant:e.buttonVariantTypes.LINK,size:e.sizeTypes.EXTRA_SMALL},on:{click:function(t){return e.$emit("addAction")}}},[r("font-awesome-icon",{attrs:{icon:"plus"}}),e._v("\n          "+e._s(e.$t("application.buttons.add.title"))+"\n        ")],1)],1):e._e()],2)],2)],1)}),[],!1,null,null,null);t.a=component.exports},770:function(e,t,r){var content=r(894);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(94).default)("b970c06e",content,!0,{sourceMap:!1})},893:function(e,t,r){"use strict";r(770)},894:function(e,t,r){var n=r(93)(!1);n.push([e.i,".fb-triggers-create-view__container{position:relative;height:100%}.fb-triggers-create-view__container .fb-triggers-create-general__general{padding:1rem}.fb-triggers-create-view__container .fb-triggers-select-date__container,.fb-triggers-create-view__container .fb-triggers-select-time__container{padding:1rem 0}.fb-triggers-create-view__container .fb-triggers-list-devices__container .fb-scroll-shadow__inner{padding:1rem}.fb-triggers-create-view__container .fb-ui-items-container__items{padding:0}.fb-triggers-create-view__container .fb-ui-items-container__items .fb-list-item__content-large{flex:0 0 13rem;max-width:13rem;padding:0}.fb-triggers-create-view__container .fb-triggers-create-general__add-item-row.fb-ui-button[data-size=lg]{margin-top:1rem;border-radius:0;border-left:none;border-right:none}.fb-triggers-create-view__container hr{margin:3rem 0}.fb-triggers-create-view__result{position:absolute;top:0;left:0;right:0;bottom:0;background-color:#f8f8f8;display:flex;flex-direction:row;align-items:center;z-index:999}.fb-triggers-create-view__result .fb-ui-spinner__container,.fb-triggers-create-view__result>div{margin-left:auto;margin-right:auto}.fb-triggers-create-view__result .fb-ui-spinner__container{width:10rem;height:10rem}.fb-triggers-create-view__result .fb-ui-spinner__container:after,.fb-triggers-create-view__result .fb-ui-spinner__container:before{width:10rem;height:10rem;margin:-5rem 0 0 -5rem;border-width:4px}",""]),e.exports=n},918:function(e,t,r){"use strict";r.r(t);r(49),r(56),r(32),r(64),r(48),r(59);var n,o=r(20),c=r(16),d=r(18),l=r(24),f=(r(21),r(711)),m=r(693),v=r(706),_=r(710),h=r(777),E=r(705),w=r(681),y=r(88);!function(e){e.GENERAL_INFO="generalInfo",e.LIST_CONDITION_DEVICES="listConditionDevices",e.LIST_ACTION_DEVICES="listActionDevices",e.SELECT_CONDITION_DEVICE="selectConditionDevice",e.SELECT_ACTION_DEVICE="selectActionDevice",e.CONFIGURE_TIME="configureTime",e.CONFIGURE_DATE="configureDate"}(n||(n={}));var T=Object(o.b)({name:"TriggerCreatePage",components:{TriggersCreateGeneral:f.a,TriggersListDevices:m.b,TriggersSelectConditionDevice:v.a,TriggersSelectTime:_.a,TriggersSelectDate:h.a,TriggersSelectActionDevice:E.a},validate:function(e){var t=e.query;return void 0!==t.type&&[w.a.DATE_SCHEDULED,w.a.TIME_SCHEDULED,w.a.DEVICE,w.a.SENSOR,w.a.MANUAL].includes(null==t?void 0:t.type)},transition:"fade",setup:function(){var e=Object(o.l)(),t=e.app.i18n,r=e.store,f=e.$flashMessage,v=e.localePath,_=e.$routes,h=e.error,E=e.$bus,T=Object(o.n)(),k=Object(o.o)(),C=Object(o.j)(!1),I=Object(o.a)((function(){return r.state.app.windowSize})),form=Object(o.i)({model:{}}),O=Object(o.j)(!1),D=Object(o.j)(c.g.NONE),view=Object(o.i)({generalInfo:{opened:!0},listConditionDevices:{opened:!1},listActionDevices:{opened:!1},selectConditionDevice:{opened:!1,device:null},selectActionDevice:{opened:!1,device:null},configureTime:{opened:!1},configureDate:{opened:!1}}),N=Object(w.b)(T.value.query.type,form),S=N.triggerId,A=N.conditions,x=N.actions,L=N.trigger,R=N.configureDate,j=N.configureTime,U=N.configureDeviceCondition,V=N.configureDeviceAction,F=N.submitConditionDevice,H=N.submitActionDevice,B=N.submitDate,$=N.submitTime,M=N.destroy,G=Object(o.a)((function(){return view.generalInfo.opened?t.t("application.buttons.cancel.title").toString():t.t("application.buttons.back.title").toString()})),z=Object(o.a)((function(){return!(view.listConditionDevices.opened||view.listActionDevices.opened)}));function P(){var e=null,n="magic";T.value.query.type===w.a.DATE_SCHEDULED?(e=t.t("triggers.subHeadings.createDateScheduledTrigger"),n="calendar"):T.value.query.type===w.a.TIME_SCHEDULED?(e=t.t("triggers.subHeadings.createTimeScheduledTrigger"),n="clock"):T.value.query.type===w.a.DEVICE?(e=t.t("triggers.subHeadings.createDeviceControlTrigger"),n="plug"):T.value.query.type===w.a.SENSOR?(e=t.t("triggers.subHeadings.createSensorTrigger"),n="thermometer-half"):T.value.query.type===w.a.MANUAL&&(e=t.t("triggers.subHeadings.createManualTrigger"),n="gamepad"),r.dispatch("app/setHeading",{heading:t.t("triggers.headings.createTrigger"),subHeading:e,icon:n},{root:!0})}function K(e){switch(e){case n.CONFIGURE_DATE:form.model.date=R(),r.dispatch("app/setHeading",{heading:t.t("triggers.headings.configureDate"),subHeading:t.t("triggers.subHeadings.configureDate"),icon:"calendar"},{root:!0});break;case n.CONFIGURE_TIME:form.model.time=j(),r.dispatch("app/setHeading",{heading:t.t("triggers.headings.configureTime"),subHeading:t.t("triggers.subHeadings.configureTime"),icon:"clock"},{root:!0});break;case n.LIST_ACTION_DEVICES:case n.LIST_CONDITION_DEVICES:r.dispatch("app/setHeading",{heading:t.t("triggers.headings.selectDevice"),subHeading:t.t("triggers.subHeadings.selectDevice"),icon:"plug"},{root:!0});break;case n.GENERAL_INFO:P()}view[e].opened=!0,Object.keys(view).forEach((function(t){t!==n.GENERAL_INFO&&t!==n.LIST_CONDITION_DEVICES&&t!==n.LIST_ACTION_DEVICES&&t!==n.SELECT_CONDITION_DEVICE&&t!==n.SELECT_ACTION_DEVICE&&t!==n.CONFIGURE_TIME&&t!==n.CONFIGURE_DATE||e===t||(view[t].opened=!1)}))}return T.value.query.type===w.a.MANUAL?d.a.add({type:l.b.MANUAL,actions:[],notifications:[]},S,!0).catch((function(){h({statusCode:503,message:"Something went wrong"})})):d.a.add({type:l.b.AUTOMATIC,actions:[],conditions:[],notifications:[]},S,!0).catch((function(){h({statusCode:503,message:"Something went wrong"})})),Object(o.g)((function(){C.value=!0,E.$emit("wait-page_reloading",!1)})),Object(o.h)((function(){try{M()}catch(e){h({statusCode:503,message:"Something went wrong"})}})),Object(o.p)((function(){return I.value}),(function(e){e!==c.J.EXTRA_SMALL&&C.value&&k.push(v({name:_.triggers.list,hash:"".concat(y.s)}))})),P(),Object(o.m)((function(){return{title:t.t("meta.triggers.create.title").toString()}})),{view:view,remoteFormSubmit:O,remoteFormResult:D,form:form,trigger:L,conditions:A,actions:x,leftBtnText:G,rightBtnShow:z,handleOpenView:K,handleTriggerCreated:function(){k.push(v({name:_.triggers.detail,params:{id:S}}))},handleLeftBtnCallback:function(){view.generalInfo.opened?k.push(v(_.triggers.list)):view.configureDate.opened||view.configureTime.opened||view.listActionDevices.opened||view.listConditionDevices.opened?K(n.GENERAL_INFO):view.selectActionDevice.opened?K(n.LIST_ACTION_DEVICES):view.selectConditionDevice.opened&&K(n.LIST_CONDITION_DEVICES)},handleRightBtnCallback:function(){if(view.generalInfo.opened)O.value=!0;else if(view.selectConditionDevice.opened)try{F()?K(n.GENERAL_INFO):f.error(t.t("triggers.messages.atLeastOneConditionProperty").toString())}catch(e){f.error(t.t("application.messages.unknownError").toString())}else if(view.selectActionDevice.opened)try{H()?K(n.GENERAL_INFO):f.error(t.t("triggers.messages.atLeastOneActionProperty").toString())}catch(e){f.error(t.t("application.messages.unknownError").toString())}else if(view.configureDate.opened)try{B()&&K(n.GENERAL_INFO)}catch(e){f.error(t.t("application.messages.unknownError").toString())}else if(view.configureTime.opened)try{$()&&K(n.GENERAL_INFO)}catch(e){f.error(t.t("application.messages.unknownError").toString())}},handleListConditionDevices:function(e){form.model.conditions=U(e),view[n.SELECT_CONDITION_DEVICE].device=e,r.dispatch("app/setHeading",{heading:e.title,icon:e.icon},{root:!0}),K(n.SELECT_CONDITION_DEVICE)},handleListActionDevices:function(e){form.model.actions=V(e),view[n.SELECT_ACTION_DEVICE].device=e,r.dispatch("app/setHeading",{heading:e.title,icon:e.icon},{root:!0}),K(n.SELECT_ACTION_DEVICE)},viewTypes:n,selectDeviceViewTypes:m.a,triggerTypes:w.a,sizeTypes:c.J,formResultTypes:c.g,buttonVariantTypes:c.N,menuItemTypes:c.I}},head:{},meta:{hideTabs:!0}}),k=(r(893),r(58)),component=Object(k.a)(T,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"fb-triggers-create-view__container"},[r("client-only",[r("fb-layout-header-button",{attrs:{label:e.leftBtnText,type:e.menuItemTypes.BUTTON,small:"",left:""},on:{click:e.handleLeftBtnCallback}}),e._v(" "),e.rightBtnShow?r("fb-layout-header-button",{attrs:{label:e.$t("application.buttons.done.title"),type:e.menuItemTypes.BUTTON,small:"",right:""},on:{click:e.handleRightBtnCallback}}):e._e(),e._v(" "),r("fb-layout-header-spacer",{attrs:{small:""}}),e._v(" "),e.remoteFormResult===e.formResultTypes.WORKING?r("div",{staticClass:"fb-triggers-create-view__result"},[r("fb-ui-spinner")],1):e._e(),e._v(" "),e.remoteFormResult===e.formResultTypes.OK?r("div",{staticClass:"fb-triggers-create-view__result"},[r("fb-ui-result-ok")],1):e._e(),e._v(" "),e.remoteFormResult===e.formResultTypes.ERROR?r("div",{staticClass:"fb-triggers-create-view__result"},[r("fb-ui-result-err")],1):e._e(),e._v(" "),e.view.generalInfo.opened?r("triggers-create-general",{attrs:{trigger:e.trigger,type:e.$route.query.type,"remote-form-submit":e.remoteFormSubmit,"remote-form-result":e.remoteFormResult},on:{"update:remoteFormSubmit":function(t){e.remoteFormSubmit=t},"update:remote-form-submit":function(t){e.remoteFormSubmit=t},"update:remoteFormResult":function(t){e.remoteFormResult=t},"update:remote-form-result":function(t){e.remoteFormResult=t},addCondition:function(t){return e.handleOpenView(e.viewTypes.LIST_CONDITION_DEVICES)},addAction:function(t){return e.handleOpenView(e.viewTypes.LIST_ACTION_DEVICES)},addTimeSchedule:function(t){return e.handleOpenView(e.viewTypes.CONFIGURE_TIME)},addDateSchedule:function(t){return e.handleOpenView(e.viewTypes.CONFIGURE_DATE)},created:e.handleTriggerCreated}}):e._e(),e._v(" "),e.view.listConditionDevices.opened?r("triggers-list-devices",{attrs:{type:e.selectDeviceViewTypes.SENSORS,items:e.conditions},on:{select:e.handleListConditionDevices}}):e._e(),e._v(" "),e.view.listActionDevices.opened?r("triggers-list-devices",{attrs:{type:e.selectDeviceViewTypes.ACTORS,items:e.actions},on:{select:e.handleListActionDevices}}):e._e(),e._v(" "),e.view.selectConditionDevice.opened&&Object.keys(e.form.model.conditions).length>0?r("triggers-select-condition-device",{attrs:{device:e.view.selectConditionDevice.device},model:{value:e.form.model.conditions,callback:function(t){e.$set(e.form.model,"conditions",t)},expression:"form.model.conditions"}}):e._e(),e._v(" "),e.view.selectActionDevice.opened&&Object.keys(e.form.model.actions).length>0?r("triggers-select-action-device",{attrs:{device:e.view.selectActionDevice.device},model:{value:e.form.model.actions,callback:function(t){e.$set(e.form.model,"actions",t)},expression:"form.model.actions"}}):e._e(),e._v(" "),e.view.configureDate.opened&&Object.keys(e.form.model.date).length>0?r("triggers-select-date",{model:{value:e.form.model.date,callback:function(t){e.$set(e.form.model,"date",t)},expression:"form.model.date"}}):e._e(),e._v(" "),e.view.configureTime.opened&&Object.keys(e.form.model.time).length>0?r("triggers-select-time",{model:{value:e.form.model.time,callback:function(t){e.$set(e.form.model,"time",t)},expression:"form.model.time"}}):e._e(),e._v(" "),r("fb-ui-loading-box",{attrs:{slot:"placeholder"},slot:"placeholder"},[r("p",[e._v("\n        "+e._s(e.$t("triggers.texts.loadingTrigger"))+"\n      ")])])],1)],1)}),[],!1,null,null,null);t.default=component.exports}}]);